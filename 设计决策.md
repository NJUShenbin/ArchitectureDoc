# 设计决策

---

### 决策1

约束

* C1: 数据存储出现故障要能继续工作
* C2: 数据存储出现故障的频率要小于1次/周
* C3: 数据故障恢复时间要小于12小时

方案

* 采用数据库集群存储评论等数据
* 采用搜索引擎集群存储商品信息数据

影响

* 全部视图

新增的约束

* AC1:  数据库集群和搜索引擎集群具有一致性更新功能
* AC2:  数据库集群和搜索引擎集群具有故障切换功能

### 决策2

约束

* C4: 服务器出现故障不影响网站访问

方案

* 运行多个应用实例

影响

* 全部视图

新增的约束

* 应用服务器要使用cluster RPC访问

### 决策3

约束

* C5: 服务器出现故障能在1小时内发现

方案: 使用Ping/Echo方法检测服务器故障

影响

* 全部视图

### 决策4

约束

* C6: 至少能兼容两种电商网站
* C7: 能兼容Amazon等英文网站

方案

* 抽象商品信息接口

影响

* 逻辑视图
* 开发视图

### 决策5

约束

* C13: 能兼容出现频率前100的关键字的同义词

方案

* 配置分词器的同义词表

影响

* 开发视图

新增的约束

* 使用的分词器允许配置同义词

### 决策6

约束

*C14: 允许通过竞价排名调整搜索排序

方案

* 在处理搜索结果的pipe中添加竞价排名的filter,用来调整结果顺序

影响

* 开发视图

### 决策7

约束

* C15: 允许屏蔽特定商品
* C16: 允许运行时添加屏蔽商品

方案

* 在搜索结果的pipe中添加屏蔽商品的filter

影响

* 开发视图

### 决策8

约束
* C18: 对频繁访问的商品,读取速度<0.01秒
* C19: 搜索的响应时间<1s

方案

* 缓存服务.将高频关键字的搜索结果缓存下来,将高频商品信息缓存下来.
* 

